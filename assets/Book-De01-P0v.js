import{y as I,_ as O,k as P,c as w,b as x,i as y,e as o,v as U,d as W,x as j,r as V,a as B,g as i,t as T,h as K,m as M,$ as L,s as z,a0 as R,a1 as Q,a2 as X,n as Y,p as Z,F as q,f as ee,l as $,A as te,o as oe,z as le}from"./index-C5gvbB0B.js";import{a as S}from"./api-MaDpu2Cb.js";import{S as ae}from"./Save-CZqpTFyI.js";import{A as se}from"./Add-DLReGzGw.js";import{B as de}from"./Bin-DFxa5Vkg.js";import{_}from"./Textarea-C5fqB0IZ.js";import{_ as ne,B as re}from"./BookTablePrint-Hn4Um7IL.js";import{f as ie,g as ue}from"./helper-CX7EnaLz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={__name:"TimeSpan",props:{modelValue:{type:String,default:""},modelModifiers:{}},emits:["update:modelValue"],setup(m){const u=I(m,"modelValue"),a=O({sh:"",sm:"",eh:"",em:""});P(u,r=>{const[l="",s=""]=(r||"").split("-"),[d="",e=""]=l.split(":"),[h="",g=""]=s.split(":");a.sh=d,a.sm=e,a.eh=h,a.em=g},{immediate:!0});const n=(r,l)=>{let s=a[r].replace(/[^0-9]/g,"");parseInt(s,10)>l&&(s=String(l)),a[r]=s},p=r=>{if(r.currentTarget.contains(r.relatedTarget))return;const{sh:l,sm:s,eh:d,em:e}=a;if(!l&&!s&&!d&&!e){u.value!==""&&(u.value="");return}const h=String(l||"").padStart(2,"0"),g=String(s||"").padStart(2,"0"),t=String(d||"").padStart(2,"0"),k=String(e||"").padStart(2,"0");a.sh=h,a.sm=g,a.eh=t,a.em=k,u.value=`${h}:${g}-${t}:${k}`};return(r,l)=>(x(),w("div",{onFocusout:p,class:"flex items-center"},[y(o("input",{"onUpdate:modelValue":l[0]||(l[0]=s=>a.sh=s),onInput:l[1]||(l[1]=s=>n("sh",23)),maxlength:"2","aria-label":"Start hours",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.sh]]),l[8]||(l[8]=o("span",{class:"font-bold"},":",-1)),y(o("input",{"onUpdate:modelValue":l[2]||(l[2]=s=>a.sm=s),onInput:l[3]||(l[3]=s=>n("sm",59)),maxlength:"2","aria-label":"Start minutes",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.sm]]),l[9]||(l[9]=o("span",{class:"font-bold mx-1"},"-",-1)),y(o("input",{"onUpdate:modelValue":l[4]||(l[4]=s=>a.eh=s),onInput:l[5]||(l[5]=s=>n("eh",23)),maxlength:"2","aria-label":"End hours",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.eh]]),l[10]||(l[10]=o("span",{class:"font-bold"},":",-1)),y(o("input",{"onUpdate:modelValue":l[6]||(l[6]=s=>a.em=s),onInput:l[7]||(l[7]=s=>n("em",59)),maxlength:"2","aria-label":"End minutes",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.em]])],32))}},me={class:"flex items-center"},A={__name:"Multiplier",props:{modelValue:{type:Number,default:null},modelModifiers:{}},emits:["update:modelValue"],setup(m){const u=I(m,"modelValue"),a=n=>{let r=n.target.value.replace(/[^0-9]/g,""),l=parseInt(r,10);isNaN(l)||r===""?u.value=null:u.value=l};return(n,p)=>(x(),w("div",me,[p[1]||(p[1]=o("span",null,"x",-1)),y(o("input",{type:"text","onUpdate:modelValue":p[0]||(p[0]=r=>u.value=r),onInput:a,"aria-label":"Worker multiplier",class:"w-4 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,u.value]])]))}},ce={id:"table",class:"p-3 mb-20 w-[2080px] print:hidden"},ve={class:"w-full"},pe={class:"report-header"},fe={class:"flex items-center justify-between font-bold mb-3 p-3"},he={class:"flex flex-col items-center"},ge={class:"text-md"},be={class:"flex justify-center items-center"},we={class:"text-md"},xe={key:0,class:"text-md ml-20"},Ve={class:"row-div"},ye={class:"row-div"},_e={class:"row-div"},Te={class:"row-div"},Ue={class:"row-div"},ke=["onUpdate:modelValue","onChange"],$e=["value"],Se={class:"row-div"},Ie=["onUpdate:modelValue","onInput"],De={class:"row-div"},Ne=["onUpdate:modelValue","onInput"],Ce={class:"row-div"},Ee={class:"row-div"},Be={class:"row-div"},Me={class:"row-div"},ze={class:"row-div"},Je={class:"entity-grid"},Ae={class:"row-div"},We={class:"row-div"},Re={class:"row-div"},qe=W({__name:"BookTable",props:j({entries:Array,entryTypes:Array,address:String,formattedDate:String,type:[String,Number]},{anfahrt:{},anfahrtModifiers:{},placeholder2:{},placeholder2Modifiers:{}}),emits:["update:anfahrt","update:placeholder2"],setup(m,{expose:u}){const a=I(m,"anfahrt"),n=I(m,"placeholder2"),p=V(null),r=(s,d,e)=>{if(d)return"bg-red-200";if(e)return"bg-gray-200";switch(s){case 0:return"bg-white";case 1:return"bg-blue-100";case 2:return"bg-green-100";case 3:return"bg-green-200";default:return"bg-white"}},l=async()=>{await R(),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})};return u({scrollToEnd:l}),(s,d)=>(x(),w("div",ce,[o("div",ve,[o("div",pe,[o("div",fe,[d[2]||(d[2]=o("p",{class:"text-lg font-bold mr-2"},"Kommunikationsbuch",-1)),o("div",he,[o("p",ge,"Gebäudename: "+T(m.address),1),o("div",be,[o("p",we,"Monat und Jahr: "+T(m.formattedDate),1),m.entryTypes[m.type]?(x(),w("p",xe,T(m.entryTypes[m.type].name),1)):K("",!0)])]),d[3]||(d[3]=o("p",{class:"text-md"},"K-V-I Gebäudemanagement",-1))])]),d[7]||(d[7]=B('<div class="entity-grid bg-gray-100 font-bold text-center top-0 z-10 border-t"><div class="row-div">Pos.</div><div class="row-div">Haus-Nr.</div><div class="row-div">Raum-Nr.</div><div class="row-div">Reparatur (Beschreibungstext)</div><div class="row-div">Typ</div><div class="row-div">festgestellt am:</div><div class="row-div">erledigt am:</div><div class="row-div">Uhrzeit bei Noteinsatz:</div><div class="row-div">Anfahrt</div><div class="row-div">Rückinfo ans Amt</div><div class="row-div">Extra Arbeit</div><div class="row-div"></div></div>',1)),i(M(L),{ref_key:"scroller",ref:p,items:m.entries,"min-item-size":20,"key-field":"index",onResize:l},{default:z(({item:e,index:h,active:g})=>[i(M(Q),{item:e,active:g,"size-dependencies":[e.roomNumber,e.houseNumber,e.extraJob],"data-index":h},{default:z(()=>[(x(),w("div",{key:e.index,class:Y([[r(e.dateType,e.deleted,e.edited),"entity-grid"],"entity-grid"]),style:X({backgroundColor:r(e.dateType)})},[o("div",Ve,T(e.index+1),1),o("div",ye,[i(_,{modelValue:e.houseNumber,"onUpdate:modelValue":[t=>e.houseNumber=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",_e,[i(_,{modelValue:e.roomNumber,"onUpdate:modelValue":[t=>e.roomNumber=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Te,[i(_,{class:"w-full",modelValue:e.repairDescription,"onUpdate:modelValue":[t=>e.repairDescription=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ue,[y(o("select",{"onUpdate:modelValue":t=>e.entryTypeId=t,onChange:t=>e.edited=!0,class:"w-full"},[(x(!0),w(q,null,ee(m.entryTypes,t=>(x(),w("option",{key:t.id,value:t.id},T(t.name),9,$e))),128))],40,ke),[[Z,e.entryTypeId,void 0,{number:!0}]])]),o("div",Se,[y(o("input",{"onUpdate:modelValue":t=>e.noticedDate=t,type:"date",class:"w-full p-1 print:hidden",onInput:t=>e.edited=!0},null,40,Ie),[[U,e.noticedDate]])]),o("div",De,[y(o("input",{"onUpdate:modelValue":t=>e.completedDate=t,type:"date",class:"w-full p-1 print:hidden",onInput:t=>e.edited=!0},null,40,Ne),[[U,e.completedDate]])]),o("div",Ce,[i(J,{modelValue:e.emergencyStartTime,"onUpdate:modelValue":[t=>e.emergencyStartTime=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"]),i(A,{modelValue:e.emergencyWorkerCount,"onUpdate:modelValue":[t=>e.emergencyWorkerCount=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ee,[i(_,{class:"w-full",modelValue:e.travelInfo,"onUpdate:modelValue":[t=>e.travelInfo=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Be,[i(ne,{class:"w-full h-full",modelValue:e.feedbackToOffice,"onUpdate:modelValue":[t=>e.feedbackToOffice=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Me,[i(J,{modelValue:e.extraJob,"onUpdate:modelValue":[t=>e.extraJob=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"]),i(A,{modelValue:e.extraJobWorkerCount,"onUpdate:modelValue":[t=>e.extraJobWorkerCount=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"]),i(_,{modelValue:e.extraJobDescription,"onUpdate:modelValue":[t=>e.extraJobDescription=t,t=>e.edited=!0],class:"w-full h-full"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",ze,[i(de,{class:"hover:text-red-500",onClick:t=>e.deleted=!e.deleted},null,8,["onClick"])])],6))]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"]),o("div",Je,[o("div",Ae,T(m.entries.length+1),1),d[4]||(d[4]=B('<div class="row-div"></div><div class="row-div"></div><div class="border-r border-b p-1">Bearbeitet:</div><div class="row-div"></div><div class="row-div"></div><div class="row-div"></div><div class="border-r border-b p-1">Anfahrt</div>',7)),o("div",We,[i(_,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value=e)},null,8,["modelValue"])]),d[5]||(d[5]=o("div",{class:"row-div"},null,-1)),o("div",Re,[i(_,{modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=e=>n.value=e)},null,8,["modelValue"])]),d[6]||(d[6]=o("div",{class:"row-div"},null,-1))])])]))}}),Fe={key:0,class:"bg-red-500 text-white p-4 rounded print:hidden"},Ge={key:1},He={class:"fixed bottom-4 left-4 flex space-x-4 print:hidden"},Oe=["disabled"],tt=W({__name:"Book",setup(m){const u=te(),a=V(""),n=V([]),p=V(null),r=$(()=>u.params.id),l=$(()=>u.query.year),s=$(()=>u.query.month),d=$(()=>u.query.day),e=$(()=>u.query.type),h=V(""),g=V(),t=V(!1),k=V(null),D=V([]),F=async()=>{var f;n.value=await S.getEntries({houseId:r.value,year:l.value,month:s.value,day:d.value,type:e.value}),n.value.forEach((v,b)=>{v.edited=!1,v.index=b}),(f=k.value)==null||f.scrollToEnd()};oe(async()=>{if(r.value){const f=await S.getHouseById(r.value);a.value=f.address}D.value=await S.getEntryTypes(),F()}),le(async()=>{await N()});const N=async()=>{if(!t.value){t.value=!0;try{if(n.value.length===0)return;const f=n.value.filter(c=>c.deleted),v=[];f.forEach(c=>{c.id&&v.push(c.id)}),v.length>0&&await S.deleteEntries(v),n.value=n.value.filter(c=>!c.deleted);const b=n.value.filter(c=>c.edited);let E=[];b.length>0&&(E=await S.updateEntries(b));for(let c=0;c<b.length;c++)b[c].id=E[c].id;n.value.forEach((c,H)=>{c.edited=!1,c.index=H})}catch(f){p.value=f,console.error(f)}finally{t.value=!1}}},G=async()=>{var v;const f={index:n.value.length,entryTypeId:1,houseId:Number(r.value),houseNumber:null,roomNumber:null,repairDescription:null,noticedDate:ue(),completedDate:null,dateType:0,emergencyStartTime:null,emergencyWorkerCount:1,travelInfo:null,feedbackToOffice:!1,extraJob:null,extraJobWorkerCount:1,extraJobDescription:null,edited:!0,deleted:!1};n.value.push(f),await R(),(v=k.value)==null||v.scrollToEnd()},C=$(()=>ie(d.value,s.value,l.value));return(f,v)=>(x(),w(q,null,[p.value?(x(),w("div",Fe,T(p.value),1)):(x(),w("div",Ge,[i(qe,{ref_key:"bookTable",ref:k,entries:n.value,entryTypes:D.value,address:a.value,formattedDate:C.value,type:e.value,anfahrt:h.value,"onUpdate:anfahrt":v[0]||(v[0]=b=>h.value=b),placeholder2:g.value,"onUpdate:placeholder2":v[1]||(v[1]=b=>g.value=b)},null,8,["entries","entryTypes","address","formattedDate","type","anfahrt","placeholder2"]),i(re,{class:"hidden",entries:n.value,entryTypes:D.value,address:a.value,formattedDate:C.value,type:e.value,anfahrt:h.value,placeholder2:g.value},null,8,["entries","entryTypes","address","formattedDate","type","anfahrt","placeholder2"])])),o("div",He,[o("button",{onClick:G,class:"bg-white text-gray-800 p-4 rounded-lg shadow-lg hover:shadow-xl border border-gray-200 transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 flex items-center"},[i(se,{class:"w-6 h-6"})]),o("button",{onClick:N,disabled:t.value,class:"bg-white text-gray-800 p-4 rounded-lg shadow-lg hover:shadow-xl border border-gray-200 transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 flex items-center disabled:opacity-50 disabled:cursor-not-allowed"},[i(ae,{class:"w-6 h-6 text-green-500"})],8,Oe)])],64))}});export{tt as default};
