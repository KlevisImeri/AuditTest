import{d as S,D as N}from"./DragHandleIcon-Dcib8C_H.js";import{B as z}from"./Bin-ClkCitXA.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as n,e,b as l,d as D,r as d,o as H,h as w,g as u,s as R,m as A,t as v}from"./index-P1hm27MN.js";import{a as g}from"./api-MaDpu2Cb.js";import"./_commonjsHelpers-Bx2EM-6T.js";const M={},E={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function F(_,r){return l(),n("svg",E,r[0]||(r[0]=[e("path",{fill:"currentColor",d:"m14 18l-6-6l6-6l1.4 1.4l-4.6 4.6l4.6 4.6z"},null,-1)]))}const j=k(M,[["render",F]]),K={},U={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function W(_,r){return l(),n("svg",U,r[0]||(r[0]=[e("path",{fill:"currentColor",d:"M12.6 12L8 7.4L9.4 6l6 6l-6 6L8 16.6z"},null,-1)]))}const q=k(K,[["render",W]]),G={class:"mx-10 mt-7 bg-white"},J={key:0,class:"text-center p-4"},O={key:1,class:"max-w-6xl mx-auto"},Q={class:"w-full border-collapse border border-gray-200 rounded-lg shadow-md"},T={class:"hover:bg-gray-50"},X={class:"border border-gray-200 p-2 text-center cursor-move drag-handle"},Y={class:"border border-gray-200 p-2 font-medium"},Z={class:"border border-gray-200 p-2"},ee={class:"border border-gray-200 p-2"},te=["onClick","title"],se={key:0,class:"text-green-600 font-bold text-lg"},re={key:1,class:"text-gray-400 text-lg hover:text-gray-600"},oe={class:"border border-gray-200 p-2 text-center"},ae=["onClick"],ne={key:0},le={key:1},ie={colspan:"6",class:"text-center p-3"},de={class:"flex justify-center items-center space-x-4"},ce=["disabled"],ue={class:"text-gray-600 text-sm"},ge=["disabled"],he={key:2,class:"text-center p-8 text-gray-500"},me=D({__name:"Invoices",setup(_){const r=d([]),x=d([]),a=d(0),m=d(40),i=d(!0),f=d(!1),h=d(!0),b=d(!1),I=async()=>{try{x.value=await g.getHouses()}catch(s){console.error("Fehler beim Laden der Häuser:",s)}},c=async s=>{s===0?i.value=!0:f.value=!0;try{let t=await g.getInvoiceVarsPaged(s,m.value);Array.isArray(t)&&t.length!=0?r.value=t:(t=[],a.value--),h.value=t.length===m.value}catch(t){console.error("Fehler beim Laden der Rechnungen:",t),h.value=!1}finally{i.value=!1,f.value=!1}},C=async s=>{try{s.isPaid=!s.isPaid,await g.updateInvoiceVars([s])}catch(t){s.isPaid=!s.isPaid,console.error("Fehler beim Aktualisieren des Bezahlstatus:",t)}},V=()=>{a.value>0&&!i.value&&(a.value--,c(a.value))},P=()=>{h.value&&!i.value&&(a.value++,c(a.value))},$=async s=>{confirm("Möchten Sie diese Rechnung wirklich löschen?")&&(await g.deleteInvoiceVar(s),r.value=r.value.filter(t=>t.id!==s),await c(a.value))},B=async s=>{if(!b.value){b.value=!0;try{const{oldIndex:t,newIndex:o}=s;if(t===o)return;const p=r.value[o],y=r.value[o+1].invoiceNr;await g.reorderInvoiceVar(p.id,y),await c(a.value)}finally{b.value=!1}}},L=s=>{const t=x.value.find(o=>o.id===s);return t?t.name:`Haus ${s}`};return H(async()=>{await I(),await c(0)}),(s,t)=>(l(),n("div",G,[t[4]||(t[4]=e("div",{class:"flex justify-center items-center mb-4"},[e("h1",{class:"text-3xl font-bold text-gray-800"},"Rechnungen")],-1)),i.value&&r.value.length===0?(l(),n("div",J,t[1]||(t[1]=[e("p",{class:"text-gray-500"},"Daten werden geladen...",-1)]))):(l(),n("div",O,[e("table",Q,[t[3]||(t[3]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-200 p-2 text-left w-12"}),e("th",{class:"border border-gray-200 p-2 text-left"}," Rechnungsnummer "),e("th",{class:"border border-gray-200 p-2 text-left"},"Haus"),e("th",{class:"border border-gray-200 p-2 text-left"},"Datum"),e("th",{class:"border border-gray-200 p-2 text-left"},"Bezahlt?"),e("th",{class:"border border-gray-200 p-2 text-left w-12"})])],-1)),u(A(S),{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),tag:"tbody","item-key":"id",onEnd:B,handle:".drag-handle"},{item:R(({element:o,index:p})=>[e("tr",T,[e("td",X,[u(N,{class:"w-5 h-5 text-gray-400"})]),e("td",Y,v(o.invoiceNr),1),e("td",Z,v(L(o.houseId)),1),e("td",ee,v(`${o.year}/${String(o.month).padStart(2,"0")}`),1),e("td",{class:"border border-gray-200 p-2 text-center cursor-pointer hover:bg-gray-100 transition-colors",onClick:y=>C(o),title:o.isPaid?"Als unbezahlt markieren":"Als bezahlt markieren"},[o.isPaid?(l(),n("span",se," ✓ ")):(l(),n("span",re," ○ "))],8,te),e("td",oe,[e("button",{onClick:y=>$(o.id),class:"text-red-600 hover:text-red-800 p-1",title:"Löschen"},[u(z,{class:"w-5 h-5"})],8,ae)])])]),_:1},8,["modelValue"]),f.value?(l(),n("tfoot",ne,t[2]||(t[2]=[e("tr",null,[e("td",{colspan:"6",class:"text-center p-3 text-gray-500"}," Weitere Daten werden geladen... ")],-1)]))):r.value.length>0?(l(),n("tfoot",le,[e("tr",null,[e("td",ie,[e("div",de,[e("button",{onClick:V,disabled:a.value===0||i.value,class:"bg-white text-gray-800 p-2 rounded-lg shadow-md hover:shadow-lg border border-gray-200 transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",title:"Vorherige Seite"},[u(j,{class:"w-5 h-5"})],8,ce),e("span",ue," Seite "+v(a.value+1),1),e("button",{onClick:P,disabled:!h.value||i.value,class:"bg-white text-gray-800 p-2 rounded-lg shadow-md hover:shadow-lg border border-gray-200 transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",title:"Nächste Seite"},[u(q,{class:"w-5 h-5"})],8,ge)])])])])):w("",!0)])])),r.value.length===0&&!i.value?(l(),n("div",he," Keine Rechnungen vorhanden ")):w("",!0)]))}});export{me as default};
