import{p as I,_ as O,s as j,c as w,b as V,i as y,e as l,v as U,d as A,V as K,r as x,a as M,g as r,t as T,h as L,k as B,$ as P,X as J,a0 as q,a1 as X,a2 as Y,n as Q,F as R,f as Z,l as ee,q as k,Y as te,o as le,W as oe}from"./index-DsQlkQdz.js";import{a as S}from"./api-Caf7j-qN.js";import{B as ae,S as se}from"./Bin-Cvda0mKq.js";import{A as de}from"./Add-BENw0Ttl.js";import{_}from"./Textarea-C7VMePQG.js";import{_ as ne,a as ie}from"./BookTablePrint.vue_vue_type_style_index_0_lang-DRj7fs11.js";import{f as re,g as ue}from"./helper-C8W09Boa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const z={__name:"TimeSpan",props:{modelValue:{type:String,default:""},modelModifiers:{}},emits:["update:modelValue"],setup(m){const u=I(m,"modelValue"),a=O({sh:"",sm:"",eh:"",em:""});j(u,i=>{const[o="",s=""]=(i||"").split("-"),[d="",e=""]=o.split(":"),[h="",g=""]=s.split(":");a.sh=d,a.sm=e,a.eh=h,a.em=g},{immediate:!0});const n=(i,o)=>{let s=a[i].replace(/[^0-9]/g,"");parseInt(s,10)>o&&(s=String(o)),a[i]=s},p=i=>{if(i.currentTarget.contains(i.relatedTarget))return;const{sh:o,sm:s,eh:d,em:e}=a;if(!o&&!s&&!d&&!e){u.value!==""&&(u.value="");return}const h=String(o||"").padStart(2,"0"),g=String(s||"").padStart(2,"0"),t=String(d||"").padStart(2,"0"),$=String(e||"").padStart(2,"0");a.sh=h,a.sm=g,a.eh=t,a.em=$,u.value=`${h}:${g}-${t}:${$}`};return(i,o)=>(V(),w("div",{onFocusout:p,class:"flex items-center"},[y(l("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>a.sh=s),onInput:o[1]||(o[1]=s=>n("sh",23)),maxlength:"2","aria-label":"Start hours",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.sh]]),o[8]||(o[8]=l("span",{class:"font-bold"},":",-1)),y(l("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>a.sm=s),onInput:o[3]||(o[3]=s=>n("sm",59)),maxlength:"2","aria-label":"Start minutes",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.sm]]),o[9]||(o[9]=l("span",{class:"font-bold mx-1"},"-",-1)),y(l("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>a.eh=s),onInput:o[5]||(o[5]=s=>n("eh",23)),maxlength:"2","aria-label":"End hours",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.eh]]),o[10]||(o[10]=l("span",{class:"font-bold"},":",-1)),y(l("input",{"onUpdate:modelValue":o[6]||(o[6]=s=>a.em=s),onInput:o[7]||(o[7]=s=>n("em",59)),maxlength:"2","aria-label":"End minutes",class:"w-8 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,a.em]])],32))}},me={class:"flex items-center"},W={__name:"Multiplier",props:{modelValue:{type:Number,default:null},modelModifiers:{}},emits:["update:modelValue"],setup(m){const u=I(m,"modelValue"),a=n=>{let i=n.target.value.replace(/[^0-9]/g,""),o=parseInt(i,10);isNaN(o)||i===""?u.value=null:u.value=o};return(n,p)=>(V(),w("div",me,[p[1]||(p[1]=l("span",null,"x",-1)),y(l("input",{type:"text","onUpdate:modelValue":p[0]||(p[0]=i=>u.value=i),onInput:a,"aria-label":"Worker multiplier",class:"w-4 text-center border border-gray-200 bg-white p-0 m-0 text-inherit outline-none focus:border-gray-500 focus:ring-0 rounded-sm"},null,544),[[U,u.value]])]))}},ce={id:"table",class:"p-3 mb-20 w-[2080px] print:hidden"},ve={class:"w-full"},pe={class:"report-header"},fe={class:"flex items-center justify-between font-bold mb-3 p-3"},he={class:"flex flex-col items-center"},ge={class:"text-md"},be={class:"flex justify-center items-center"},we={class:"text-md"},Ve={key:0,class:"text-md ml-20"},xe={class:"row-div"},ye={class:"row-div"},_e={class:"row-div"},Te={class:"row-div"},Ue={class:"row-div"},$e=["onUpdate:modelValue","onChange"],ke=["value"],Se={class:"row-div"},Ie=["onUpdate:modelValue","onInput"],De={class:"row-div"},Ne=["onUpdate:modelValue","onInput"],Ce={class:"row-div"},Ee={class:"row-div"},Me={class:"row-div"},Be={class:"row-div"},Je={class:"row-div"},ze={class:"entity-grid"},We={class:"row-div"},Ae={class:"row-div"},qe={class:"row-div"},Re=A({__name:"BookTable",props:K({entries:Array,entryTypes:Array,address:String,formattedDate:String,type:[String,Number]},{anfahrt:{},anfahrtModifiers:{},placeholder2:{},placeholder2Modifiers:{}}),emits:["update:anfahrt","update:placeholder2"],setup(m,{expose:u}){const a=I(m,"anfahrt"),n=I(m,"placeholder2"),p=x(null),i=(s,d,e)=>{if(d)return"bg-red-200";if(e)return"bg-gray-200";switch(s){case 0:return"bg-white";case 1:return"bg-blue-100";case 2:return"bg-green-100";case 3:return"bg-green-200";default:return"bg-white"}},o=async()=>{await q(),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})};return u({scrollToEnd:o}),(s,d)=>(V(),w("div",ce,[l("div",ve,[l("div",pe,[l("div",fe,[d[2]||(d[2]=l("p",{class:"text-lg font-bold mr-2"},"Kommunikationsbuch",-1)),l("div",he,[l("p",ge,"Gebäudename: "+T(m.address),1),l("div",be,[l("p",we,"Monat und Jahr: "+T(m.formattedDate),1),m.entryTypes[m.type]?(V(),w("p",Ve,T(m.entryTypes[m.type].name),1)):L("",!0)])]),d[3]||(d[3]=l("p",{class:"text-md"},"K-V-I Gebäudemanagement",-1))])]),d[7]||(d[7]=M('<div class="entity-grid bg-gray-100 font-bold text-center top-0 z-10 border-t"><div class="row-div">Pos.</div><div class="row-div">Haus-Nr.</div><div class="row-div">Raum-Nr.</div><div class="row-div">Reparatur (Beschreibungstext)</div><div class="row-div">Typ</div><div class="row-div">festgestellt am:</div><div class="row-div">erledigt am:</div><div class="row-div">Uhrzeit bei Noteinsatz:</div><div class="row-div">Anfahrt</div><div class="row-div">Rückinfo ans Amt</div><div class="row-div">Extra Arbeit</div><div class="row-div"></div></div>',1)),r(B(P),{ref_key:"scroller",ref:p,items:m.entries,"min-item-size":20,"key-field":"index",onResize:o},{default:J(({item:e,index:h,active:g})=>[r(B(X),{item:e,active:g,"size-dependencies":[e.roomNumber,e.houseNumber,e.extraJob],"data-index":h},{default:J(()=>[(V(),w("div",{key:e.index,class:Q([[i(e.dateType,e.deleted,e.edited),"entity-grid"],"entity-grid"]),style:Y({backgroundColor:i(e.dateType)})},[l("div",xe,T(e.index+1),1),l("div",ye,[r(_,{modelValue:e.houseNumber,"onUpdate:modelValue":[t=>e.houseNumber=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),l("div",_e,[r(_,{modelValue:e.roomNumber,"onUpdate:modelValue":[t=>e.roomNumber=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Te,[r(_,{class:"w-full",modelValue:e.repairDescription,"onUpdate:modelValue":[t=>e.repairDescription=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Ue,[y(l("select",{"onUpdate:modelValue":t=>e.entryTypeId=t,onChange:t=>e.edited=!0,class:"w-full"},[(V(!0),w(R,null,Z(m.entryTypes,t=>(V(),w("option",{key:t.id,value:t.id},T(t.name),9,ke))),128))],40,$e),[[ee,e.entryTypeId,void 0,{number:!0}]])]),l("div",Se,[y(l("input",{"onUpdate:modelValue":t=>e.noticedDate=t,type:"date",class:"w-full p-1 print:hidden",onInput:t=>e.edited=!0},null,40,Ie),[[U,e.noticedDate]])]),l("div",De,[y(l("input",{"onUpdate:modelValue":t=>e.completedDate=t,type:"date",class:"w-full p-1 print:hidden",onInput:t=>e.edited=!0},null,40,Ne),[[U,e.completedDate]])]),l("div",Ce,[r(z,{modelValue:e.emergencyStartTime,"onUpdate:modelValue":[t=>e.emergencyStartTime=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"]),r(W,{modelValue:e.emergencyWorkerCount,"onUpdate:modelValue":[t=>e.emergencyWorkerCount=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Ee,[r(_,{class:"w-full",modelValue:e.travelInfo,"onUpdate:modelValue":[t=>e.travelInfo=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Me,[r(ne,{class:"w-full h-full",modelValue:e.feedbackToOffice,"onUpdate:modelValue":[t=>e.feedbackToOffice=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Be,[r(z,{modelValue:e.extraJob,"onUpdate:modelValue":[t=>e.extraJob=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"]),r(W,{modelValue:e.extraJobWorkerCount,"onUpdate:modelValue":[t=>e.extraJobWorkerCount=t,t=>e.edited=!0]},null,8,["modelValue","onUpdate:modelValue"]),r(_,{modelValue:e.extraJobDescription,"onUpdate:modelValue":[t=>e.extraJobDescription=t,t=>e.edited=!0],class:"w-full h-full"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Je,[r(ae,{class:"hover:text-red-500",onClick:t=>{e.deleted=!e.deleted}},null,8,["onClick"])])],6))]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"]),l("div",ze,[l("div",We,T(m.entries.length+1),1),d[4]||(d[4]=M('<div class="row-div"></div><div class="row-div"></div><div class="border-r border-b p-1">Bearbeitet:</div><div class="row-div"></div><div class="row-div"></div><div class="row-div"></div><div class="border-r border-b p-1">Anfahrt</div>',7)),l("div",Ae,[r(_,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value=e)},null,8,["modelValue"])]),d[5]||(d[5]=l("div",{class:"row-div"},null,-1)),l("div",qe,[r(_,{modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=e=>n.value=e)},null,8,["modelValue"])]),d[6]||(d[6]=l("div",{class:"row-div"},null,-1))])])]))}}),Fe={key:0,class:"bg-red-500 text-white p-4 rounded print:hidden"},Ge={key:1},He={class:"fixed bottom-4 left-4 flex space-x-4 print:hidden"},Oe=["disabled"],et=A({__name:"Book",setup(m){const u=te(),a=x(""),n=x([]),p=x(null),i=k(()=>u.params.id),o=k(()=>u.query.year),s=k(()=>u.query.month),d=k(()=>u.query.day),e=k(()=>u.query.type),h=x(""),g=x(),t=x(!1),$=x(null),D=x([]),F=async()=>{var f;n.value=await S.getEntries({houseId:i.value,year:o.value,month:s.value,day:d.value,type:e.value}),n.value.forEach((v,b)=>{v.edited=!1,v.index=b}),(f=$.value)==null||f.scrollToEnd()};le(async()=>{if(i.value){const f=await S.getHouseById(i.value);a.value=f.address}D.value=await S.getEntryTypes(),F()}),oe(async()=>{await N()});const N=async()=>{if(!t.value){t.value=!0;try{if(n.value.length===0)return;const f=n.value.filter(c=>c.deleted),v=[];f.forEach(c=>{c.id&&v.push(c.id)}),v.length>0&&await S.deleteEntries(v),n.value=n.value.filter(c=>!c.deleted);const b=n.value.filter(c=>c.edited);let E=[];b.length>0&&(E=await S.updateEntries(b));for(let c=0;c<b.length;c++)b[c].id=E[c].id;n.value.forEach((c,H)=>{c.edited=!1,c.index=H})}catch(f){p.value=f,console.error(f)}finally{t.value=!1}}},G=async()=>{var v;const f={index:n.value.length,entryTypeId:1,houseId:Number(i.value),houseNumber:null,roomNumber:null,repairDescription:null,noticedDate:ue(),completedDate:null,dateType:0,emergencyStartTime:null,emergencyWorkerCount:1,travelInfo:null,feedbackToOffice:!1,extraJob:null,extraJobWorkerCount:1,extraJobDescription:null,edited:!0,deleted:!1};n.value.push(f),await q(),(v=$.value)==null||v.scrollToEnd()},C=k(()=>re(d.value,s.value,o.value));return(f,v)=>(V(),w(R,null,[p.value?(V(),w("div",Fe,T(p.value),1)):(V(),w("div",Ge,[r(Re,{ref_key:"bookTable",ref:$,entries:n.value,entryTypes:D.value,address:a.value,formattedDate:C.value,type:e.value,anfahrt:h.value,"onUpdate:anfahrt":v[0]||(v[0]=b=>h.value=b),placeholder2:g.value,"onUpdate:placeholder2":v[1]||(v[1]=b=>g.value=b)},null,8,["entries","entryTypes","address","formattedDate","type","anfahrt","placeholder2"]),r(ie,{class:"hidden",entries:n.value,entryTypes:D.value,address:a.value,formattedDate:C.value,type:e.value,anfahrt:h.value,placeholder2:g.value},null,8,["entries","entryTypes","address","formattedDate","type","anfahrt","placeholder2"])])),l("div",He,[l("button",{onClick:G,class:"bg-white text-gray-800 p-4 rounded-lg shadow-lg hover:shadow-xl border border-gray-200 transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 flex items-center"},[r(de,{class:"w-6 h-6"})]),l("button",{onClick:N,disabled:t.value,class:"bg-white text-gray-800 p-4 rounded-lg shadow-lg hover:shadow-xl border border-gray-200 transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 flex items-center disabled:opacity-50 disabled:cursor-not-allowed"},[r(se,{class:"w-6 h-6 text-green-500"})],8,Oe)])],64))}});export{et as default};
